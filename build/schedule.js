(()=>{"use strict";var e={n:s=>{var a=s&&s.__esModule?()=>s.default:()=>s;return e.d(a,{a}),a},d:(s,a)=>{for(var t in a)e.o(a,t)&&!e.o(s,t)&&Object.defineProperty(s,t,{enumerable:!0,get:a[t]})},o:(e,s)=>Object.prototype.hasOwnProperty.call(e,s)};const s=window.wp.domReady;var a=e.n(s);const t=window.wp.element,n=window.wp.components,o=window.wp.i18n,i={sat:["09:00-12:00"],sun:["09:00-12:00"],mon:["09:00-12:00"],tue:["09:00-12:00"],wed:["09:00-12:00"],thu:["09:00-12:00"],fri:[]},l={sat:{key:"sat",label:(0,o.__)("Saturday","nobat")},sun:{key:"sun",label:(0,o.__)("Sunday","nobat")},mon:{key:"mon",label:(0,o.__)("Monday","nobat")},tue:{key:"tue",label:(0,o.__)("Tuesday","nobat")},wed:{key:"wed",label:(0,o.__)("Wednesday","nobat")},thu:{key:"thu",label:(0,o.__)("Thursday","nobat")},fri:{key:"fri",label:(0,o.__)("Friday","nobat")}},r=window.ReactJSXRuntime;function c({day:e,hours:s,onAdd:a,onRemove:t,onUpdate:i}){const c=s&&s.length>0&&"09:00-12:00"!==s[0],d=e=>{const[s,a]=e.split("-").map(e=>e.trim());return{start:s||"09:00",end:a||"12:00"}},h=(a,t,n)=>{const{start:o,end:l}=d(s[a]);i(e,a,((e,s)=>`${e}-${s}`)("start"===t?n:o,"end"===t?n:l))};return(0,r.jsx)(n.PanelBody,{title:(0,r.jsxs)("div",{className:"day-panel-title",children:[(0,r.jsx)("span",{className:"day-name",children:(0,o.__)(l[e].label,"nobat")}),c&&(0,r.jsxs)("span",{className:"hours-count-chip",children:[s.length," ",1===s.length?(0,o.__)("slot","nobat"):(0,o.__)("slots","nobat")]})]}),initialOpen:!1,children:(0,r.jsxs)("div",{className:"working-hours-list",children:[s.map((s,a)=>{const{start:n,end:i}=d(s);return(0,r.jsxs)("div",{className:"working-hour-row",children:[(0,r.jsxs)("div",{className:"time-picker-group",children:[(0,r.jsxs)("div",{className:"time-picker-field",children:[(0,r.jsx)("label",{className:"time-label",children:(0,o.__)("Start","nobat")}),(0,r.jsx)("input",{type:"time",value:n,onChange:e=>h(a,"start",e.target.value),className:"time-input",step:"900",pattern:"[0-9]{2}:[0-9]{2}"})]}),(0,r.jsx)("span",{className:"time-separator",children:"â€”"}),(0,r.jsxs)("div",{className:"time-picker-field",children:[(0,r.jsx)("label",{className:"time-label",children:(0,o.__)("End","nobat")}),(0,r.jsx)("input",{type:"time",value:i,onChange:e=>h(a,"end",e.target.value),className:"time-input",step:"900",pattern:"[0-9]{2}:[0-9]{2}"})]})]}),(0,r.jsx)("button",{onClick:()=>t(e,a),className:"remove-hour-icon-button",title:(0,o.__)("Remove time slot","nobat"),type:"button",children:(0,r.jsx)("span",{className:"dashicons dashicons-minus"})})]},a)}),(0,r.jsx)("div",{className:"add-hour-section",children:(0,r.jsxs)(n.Button,{variant:"secondary",onClick:()=>a(e),className:"add-hour-button",children:[(0,r.jsx)("span",{className:"button-icon",children:"âž•"}),(0,o.__)("Add Time Slot","nobat")]})})]})})}function d({weekdays:e,weeklyHours:s,setWeeklyHours:a}){const t=e=>{a(s=>({...s,[e]:[...s[e],"09:00-12:00"]}))},n=(e,s)=>{a(a=>{const t=[...a[e]];return t.splice(s,1),{...a,[e]:t}})},i=(e,s,t)=>{a(a=>{const n=[...a[e]];return n[s]=t,{...a,[e]:n}})};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h3",{children:(0,o.__)("Weekly Hours","nobat")}),e.map(e=>(0,r.jsx)(c,{day:e,hours:s[e],onAdd:t,onRemove:n,onUpdate:i},e))]})}function h({id:e,label:s,value:a,onChange:n,placeholder:o,className:i="components-base-control__input",minDate:l="today",autoReadOnlyInput:c=!0,format:d="YYYY/MM/DD",showCloseBtn:h=!0,showTodayBtn:u=!0,persianDigits:m=!1,...p}){const _=(0,t.useRef)(null);return(0,t.useEffect)(()=>{if(window.jalaliDatepicker&&_.current){jalaliDatepicker.startWatch({minDate:l,autoReadOnlyInput:c,format:d,showCloseBtn:h,showTodayBtn:u,persianDigits:m});const e=e=>{n&&n(e.target.value)},s=_.current;return s.addEventListener("change",e),()=>{s.removeEventListener("change",e)}}},[l,c,d,h,u,m,n]),(0,r.jsxs)("div",{className:"components-base-control",children:[s&&(0,r.jsx)("label",{htmlFor:e,className:"components-base-control__label",children:s}),(0,r.jsx)("input",{ref:_,id:e,className:i,type:"text","data-jdp":!0,value:a,placeholder:o,...p})]})}const u=window.wp.apiFetch;var m=e.n(u);function p(e){if(!e||"string"!=typeof e)return console.error("jalaliToGregorian: Invalid input",e),"";const s=e.split(/[/-]/);if(3!==s.length)return console.error("jalaliToGregorian: Invalid date format",e),"";const a=parseInt(s[0],10),t=parseInt(s[1],10),n=parseInt(s[2],10);if(isNaN(a)||isNaN(t)||isNaN(n))return console.error("jalaliToGregorian: Invalid date values",e),"";if(a<1||a>3178||t<1||t>12||n<1||n>31)return console.error("jalaliToGregorian: Date out of range",e),"";try{const[s,o,i]=function(e,s,a){let t,n,o;e>979?(t=1600,e-=979):t=621;let i=365*e+(Math.floor(e/33*8)+Math.floor((e%33+3)/4))+78+a;i+=s<7?31*(s-1):30*(s-7)+186,t+=400*Math.floor(i/146097),i%=146097;let l=!0;i>=36525&&(i--,t+=100*Math.floor(i/36524),i%=36524,i>=365?i++:l=!1),t+=4*Math.floor(i/1461),i%=1461,i>=366&&(l=!1,i--,t+=Math.floor(i/365),i%=365),o=i+1;const r=[0,31,l?29:28,31,30,31,30,31,31,30,31,30,31];for(n=0;n<13&&o>r[n];n++)o-=r[n];return[t,n,o]}(a,t,n),l=String(s),r=`${l}-${String(o).padStart(2,"0")}-${String(i).padStart(2,"0")}`;return console.log("jalaliToGregorian: Converted",e,"â†’",r),r}catch(e){return console.error("jalaliToGregorian: Conversion error",e),""}}function _(){const[e,s]=(0,t.useState)(""),[a,c]=(0,t.useState)(!0),[u,_]=(0,t.useState)(""),[b,j]=(0,t.useState)(""),[v,x]=(0,t.useState)(30),[N,f]=(0,t.useState)(i),{adminUsers:g,notice:y,setNotice:w,saveSchedule:k}=function(){const[e,s]=(0,t.useState)([]),[a,n]=(0,t.useState)(null);return(0,t.useEffect)(()=>{m()({path:"/wp/v2/users?roles=administrator"}).then(e=>{s(e.map(e=>({label:e.name,value:e.id})))}).catch(()=>n({status:"error",message:(0,o.__)("Error fetching users.","nobat")}))},[]),{adminUsers:e,notice:a,setNotice:n,saveSchedule:e=>m()({path:"nobat/v2/schedules",method:"POST",data:e}).then(e=>(n({status:"success",message:(0,o.__)("Settings saved successfully!","nobat")}),e)).catch(e=>{console.error("Schedule save error:",e);let s=(0,o.__)("Error saving settings.","nobat");throw e&&e.message?s=e.message:e&&e.data&&e.data.message&&(s=e.data.message),n({status:"error",message:s}),e})}}();return(0,r.jsxs)("div",{className:"create-schedule-container",children:[(0,r.jsxs)("div",{className:"schedule-header",children:[(0,r.jsxs)("h1",{className:"schedule-title",children:["ðŸ“… ",(0,o.__)("Create New Schedule","nobat")]}),(0,r.jsx)("p",{className:"schedule-subtitle",children:(0,o.__)("Set up your availability schedule with working hours and time slots","nobat")})]}),y&&(0,r.jsx)(n.Notice,{status:y.status,isDismissible:!0,onRemove:()=>w(null),children:y.message}),(0,r.jsxs)("div",{className:"schedule-section",children:[(0,r.jsxs)("div",{className:"section-header",children:[(0,r.jsxs)("h2",{className:"section-title",children:[(0,r.jsx)("span",{className:"section-icon",children:"â„¹ï¸"}),(0,o.__)("Basic Information","nobat")]}),(0,r.jsx)("p",{className:"section-description",children:(0,o.__)("Give your schedule a name and set its status","nobat")})]}),(0,r.jsxs)("div",{className:"section-content",children:[(0,r.jsx)("div",{className:"form-row",children:(0,r.jsx)("div",{className:"form-field full-width",children:(0,r.jsx)(n.TextControl,{label:(0,o.__)("Schedule Name","nobat"),value:e,onChange:s,placeholder:(0,o.__)("e.g., Summer 2024 Schedule","nobat"),help:(0,o.__)("A descriptive name to identify this schedule","nobat")})})}),(0,r.jsx)("div",{className:"form-row",children:(0,r.jsx)("div",{className:"form-field",children:(0,r.jsx)(n.ToggleControl,{label:(0,o.__)("Activate Schedule","nobat"),checked:a,onChange:c,help:a?(0,o.__)("This schedule is active and visible to users","nobat"):(0,o.__)("This schedule is inactive and hidden from users","nobat")})})})]})]}),(0,r.jsxs)("div",{className:"schedule-section",children:[(0,r.jsxs)("div",{className:"section-header",children:[(0,r.jsxs)("h2",{className:"section-title",children:[(0,r.jsx)("span",{className:"section-icon",children:"ðŸ“†"}),(0,o.__)("Schedule Period","nobat")]}),(0,r.jsx)("p",{className:"section-description",children:(0,o.__)("Define the date range when this schedule is valid","nobat")})]}),(0,r.jsx)("div",{className:"section-content",children:(0,r.jsxs)("div",{className:"form-row two-columns",children:[(0,r.jsx)("div",{className:"form-field",children:(0,r.jsx)(h,{id:"start-day",label:(0,o.__)("Start Date","nobat"),value:u,onChange:_})}),(0,r.jsx)("div",{className:"form-field",children:(0,r.jsx)(h,{id:"end-day",label:(0,o.__)("End Date","nobat"),value:b,onChange:j})})]})})]}),(0,r.jsxs)("div",{className:"schedule-section",children:[(0,r.jsxs)("div",{className:"section-header",children:[(0,r.jsxs)("h2",{className:"section-title",children:[(0,r.jsx)("span",{className:"section-icon",children:"â±ï¸"}),(0,o.__)("Appointment Settings","nobat")]}),(0,r.jsx)("p",{className:"section-description",children:(0,o.__)("Configure the duration of each appointment slot","nobat")})]}),(0,r.jsx)("div",{className:"section-content",children:(0,r.jsx)("div",{className:"form-row",children:(0,r.jsx)("div",{className:"form-field",children:(0,r.jsx)(n.TextControl,{label:(0,o.__)("Appointment Duration (minutes)","nobat"),type:"number",value:v,onChange:e=>x(parseInt(e,10)),min:"15",step:"15",help:(0,o.__)("How long each appointment will last","nobat")})})})})]}),(0,r.jsxs)("div",{className:"schedule-section weekly-hours-section",children:[(0,r.jsxs)("div",{className:"section-header",children:[(0,r.jsxs)("h2",{className:"section-title",children:[(0,r.jsx)("span",{className:"section-icon",children:"ðŸ•"}),(0,o.__)("Weekly Working Hours","nobat")]}),(0,r.jsx)("p",{className:"section-description",children:(0,o.__)("Define your available hours for each day of the week","nobat")})]}),(0,r.jsx)("div",{className:"section-content",children:(0,r.jsx)(d,{weekdays:Object.keys(l),weeklyHours:N,setWeeklyHours:f})})]}),(0,r.jsxs)("div",{className:"schedule-actions",children:[(0,r.jsx)(n.Button,{variant:"secondary",href:"/wp-admin/admin.php?page=nobat-schedules",children:(0,o.__)("Cancel","nobat")}),(0,r.jsxs)(n.Button,{variant:"primary",onClick:()=>{const s=p(u),t=p(b);s&&t?k({name:e,isActive:a,startDate:s,endDate:t,meetingDuration:v,buffer:0,weeklyHours:N}).then(()=>{window.location.href="/wp-admin/admin.php?page=nobat-schedules&message=1"}).catch(()=>{}):w({status:"error",message:(0,o.__)("Invalid date format. Please check your dates.","nobat")})},disabled:!e||!u||!b,children:[(0,r.jsx)("span",{className:"button-icon",children:"ðŸ’¾"}),(0,o.__)("Create Schedule","nobat")]})]})]})}a()(()=>{(0,t.createRoot)(document.getElementById("nobat-scheduling")).render((0,r.jsx)(_,{}))})})();