(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.domReady;var n=e.n(t);const o=window.wp.element,a=window.wp.i18n,i=window.wp.components,s=window.ReactJSXRuntime,l=({slots:e,selectedSlot:t,onSlotSelect:n,disabled:o})=>o||0===e.length?(0,s.jsx)("div",{className:"time-slot-selector disabled",children:(0,s.jsx)("p",{children:(0,a.__)("Please select a date first","appointment-booking")})}):(0,s.jsx)("div",{className:"time-slot-selector",children:0===e.length?(0,s.jsx)("p",{className:"no-slots",children:(0,a.__)("No available slots for this date","appointment-booking")}):(0,s.jsx)("div",{className:"time-slots-grid",children:e.map(e=>(0,s.jsx)(i.Button,{variant:t===e?"primary":"secondary",onClick:()=>n(e),className:"time-slot-button "+(t===e?"selected":""),children:e},e))})}),r=()=>{const[e,t]=(0,o.useState)({client_name:"",client_phone:"",appointment_date:"",time_slot:""}),[n,r]=(0,o.useState)([]),[p,d]=(0,o.useState)(!1),[m,c]=(0,o.useState)(!1),[_,h]=(0,o.useState)(null),[b,u]=(0,o.useState)("success"),j=(e,n)=>{t(t=>({...t,[e]:n})),_&&h(null)};return(0,o.useEffect)(()=>{e.appointment_date&&(async e=>{if(e)try{c(!0);const t=await fetch(`/wp-json/appointment-booking/v1/available-slots?date=${e}`);if(!t.ok)throw new Error("Failed to fetch available slots");const n=await t.json();r(n)}catch(e){h("Failed to load available time slots"),u("error")}finally{c(!1)}else r([])})(e.appointment_date)},[e.appointment_date]),(0,s.jsx)("div",{className:"appointment-booking-form",children:(0,s.jsxs)(i.Card,{children:[(0,s.jsx)(i.CardHeader,{children:(0,s.jsx)("h3",{children:(0,a.__)("Book an Appointment","appointment-booking")})}),(0,s.jsxs)(i.CardBody,{children:[_&&(0,s.jsx)(i.Notice,{status:b,isDismissible:!0,onRemove:()=>h(null),children:_}),(0,s.jsxs)("form",{onSubmit:async n=>{if(n.preventDefault(),!(e.client_name&&e.client_phone&&e.appointment_date&&e.time_slot))return h("Please fill in all fields"),void u("error");if(!/^[\+]?[1-9][\d]{0,15}$/.test(e.client_phone.replace(/\s/g,"")))return h("Please enter a valid phone number"),void u("error");try{d(!0);const n=await fetch("/wp-json/appointment-booking/v1/appointments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok){const e=await n.json();throw new Error(e.message||"Failed to book appointment")}const o=await n.json();h(o.message||"Appointment booked successfully!"),u("success"),t({client_name:"",client_phone:"",appointment_date:"",time_slot:""}),r([])}catch(e){h(e.message||"Failed to book appointment. Please try again."),u("error")}finally{d(!1)}},className:"booking-form",children:[(0,s.jsx)("div",{className:"form-row",children:(0,s.jsx)(i.TextControl,{label:(0,a.__)("Your Name","appointment-booking"),value:e.client_name,onChange:e=>j("client_name",e),required:!0,placeholder:(0,a.__)("Enter your full name","appointment-booking")})}),(0,s.jsx)("div",{className:"form-row",children:(0,s.jsx)(i.TextControl,{label:(0,a.__)("Phone Number","appointment-booking"),value:e.client_phone,onChange:e=>j("client_phone",e),required:!0,placeholder:(0,a.__)("Enter your phone number","appointment-booking"),type:"tel"})}),(0,s.jsx)("div",{className:"form-row",children:(0,s.jsx)(i.TextControl,{label:(0,a.__)("Preferred Date","appointment-booking"),value:e.appointment_date,onChange:e=>j("appointment_date",e),required:!0,type:"date",min:(new Date).toISOString().split("T")[0]})}),(0,s.jsxs)("div",{className:"form-row",children:[(0,s.jsx)("label",{className:"time-slot-label",children:(0,a.__)("Available Time Slots","appointment-booking")}),m?(0,s.jsxs)("div",{className:"loading-slots",children:[(0,s.jsx)(i.Spinner,{}),(0,s.jsx)("span",{children:(0,a.__)("Loading available slots...","appointment-booking")})]}):(0,s.jsx)(l,{slots:n,selectedSlot:e.time_slot,onSlotSelect:e=>j("time_slot",e),disabled:!e.appointment_date})]}),(0,s.jsx)("div",{className:"form-actions",children:(0,s.jsx)(i.Button,{type:"submit",variant:"primary",disabled:p||!e.client_name||!e.client_phone||!e.appointment_date||!e.time_slot,__next40pxDefaultSize:!0,children:p?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Spinner,{}),(0,a.__)("Booking...","appointment-booking")]}):(0,a.__)("Book Appointment","appointment-booking")})})]})]})]})})};n()(()=>{(0,o.createRoot)(document.getElementById("appointment-booking-form")).render((0,s.jsx)(r,{}))})})();