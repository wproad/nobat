(()=>{"use strict";var e={n:n=>{var t=n&&n.__esModule?()=>n.default:()=>n;return e.d(t,{a:t}),t},d:(n,t)=>{for(var o in t)e.o(t,o)&&!e.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:t[o]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)};const n=window.wp.domReady;var t=e.n(n);const o=window.wp.element,i=window.wp.i18n,a=window.wp.components,s=window.ReactJSXRuntime,l=({appointment:e,onStatusUpdate:n,onDelete:t})=>{const[l,p]=(0,o.useState)(!1),[d,c]=(0,o.useState)(!1),r=[{label:(0,i.__)("Pending","appointment-booking"),value:"pending"},{label:(0,i.__)("Confirmed","appointment-booking"),value:"confirmed"},{label:(0,i.__)("Completed","appointment-booking"),value:"completed"},{label:(0,i.__)("Cancelled","appointment-booking"),value:"cancelled"}],m=e=>new Date(e).toLocaleDateString();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"appointment-row",children:[(0,s.jsx)("div",{className:"appointment-cell",children:(0,s.jsx)("strong",{children:e.client_name})}),(0,s.jsx)("div",{className:"appointment-cell",children:e.client_phone}),(0,s.jsx)("div",{className:"appointment-cell",children:m(e.appointment_date)}),(0,s.jsx)("div",{className:"appointment-cell",children:e.time_slot}),(0,s.jsx)("div",{className:"appointment-cell",children:(0,s.jsx)("span",{className:"status-badge",style:{backgroundColor:(e=>{switch(e){case"pending":return"#f0ad4e";case"confirmed":return"#5cb85c";case"completed":return"#337ab7";case"cancelled":return"#d9534f";default:return"#777"}})(e.status)},children:r.find(n=>n.value===e.status)?.label||e.status})}),(0,s.jsx)("div",{className:"appointment-cell",children:(0,s.jsxs)("div",{className:"appointment-actions",children:[(0,s.jsx)(a.Button,{variant:"secondary",size:"small",onClick:()=>p(!0),children:(0,i.__)("Edit","appointment-booking")}),(0,s.jsx)(a.Button,{variant:"link",isDestructive:!0,size:"small",onClick:()=>c(!0),children:(0,i.__)("Delete","appointment-booking")})]})})]}),l&&(0,s.jsx)(a.Modal,{title:(0,i.__)("Edit Appointment","appointment-booking"),onRequestClose:()=>p(!1),children:(0,s.jsxs)("div",{className:"appointment-edit-form",children:[(0,s.jsx)(a.TextControl,{label:(0,i.__)("Client Name","appointment-booking"),value:e.client_name,disabled:!0}),(0,s.jsx)(a.TextControl,{label:(0,i.__)("Phone","appointment-booking"),value:e.client_phone,disabled:!0}),(0,s.jsx)(a.TextControl,{label:(0,i.__)("Date","appointment-booking"),value:m(e.appointment_date),disabled:!0}),(0,s.jsx)(a.TextControl,{label:(0,i.__)("Time Slot","appointment-booking"),value:e.time_slot,disabled:!0}),(0,s.jsx)(a.SelectControl,{label:(0,i.__)("Status","appointment-booking"),value:e.status,options:r,onChange:t=>{n(e.id,t),p(!1)}})]})}),d&&(0,s.jsxs)(a.Modal,{title:(0,i.__)("Delete Appointment","appointment-booking"),onRequestClose:()=>c(!1),children:[(0,s.jsx)("p",{children:(0,i.__)("Are you sure you want to delete this appointment? This action cannot be undone.","appointment-booking")}),(0,s.jsxs)("div",{className:"modal-actions",children:[(0,s.jsx)(a.Button,{variant:"secondary",onClick:()=>c(!1),children:(0,i.__)("Cancel","appointment-booking")}),(0,s.jsx)(a.Button,{variant:"primary",isDestructive:!0,onClick:()=>{t(e.id),c(!1)},children:(0,i.__)("Delete","appointment-booking")})]})]})]})},p=()=>{const[e,n]=(0,o.useState)([]),[t,p]=(0,o.useState)(!0),[d,c]=(0,o.useState)(null),r=async()=>{try{p(!0);const e=await fetch("/wp-json/appointment-booking/v1/appointments",{headers:{"X-WP-Nonce":wpApiSettings.nonce}});if(!e.ok)throw new Error("Failed to fetch appointments");const t=await e.json();n(t),c(null)}catch(e){c("Failed to load appointments")}finally{p(!1)}};(0,o.useEffect)(()=>{r()},[]);const m=async(e,n)=>{try{if(!(await fetch(`/wp-json/appointment-booking/v1/appointments/${e}`,{method:"PUT",headers:{"Content-Type":"application/json","X-WP-Nonce":wpApiSettings.nonce},body:JSON.stringify({status:n})})).ok)throw new Error("Failed to update appointment");r()}catch(e){c("Failed to update appointment status")}},h=async e=>{if(confirm("Are you sure you want to delete this appointment?"))try{if(!(await fetch(`/wp-json/appointment-booking/v1/appointments/${e}`,{method:"DELETE",headers:{"X-WP-Nonce":wpApiSettings.nonce}})).ok)throw new Error("Failed to delete appointment");r()}catch(e){c("Failed to delete appointment")}};return t?(0,s.jsxs)("div",{className:"appointment-booking-admin",children:[(0,s.jsx)("h1",{children:(0,i.__)("Appointments","appointment-booking")}),(0,s.jsx)(a.Spinner,{})]}):(0,s.jsxs)("div",{className:"appointment-booking-admin",children:[(0,s.jsxs)("div",{className:"appointment-booking-header",children:[(0,s.jsx)("h1",{children:(0,i.__)("Appointments","appointment-booking")}),(0,s.jsx)(a.Button,{variant:"secondary",onClick:r,disabled:t,children:(0,i.__)("Refresh","appointment-booking")})]}),d&&(0,s.jsx)(a.Notice,{status:"error",isDismissible:!0,onRemove:()=>c(null),children:d}),(0,s.jsxs)(a.Card,{children:[(0,s.jsx)(a.CardHeader,{children:(0,s.jsx)("h2",{children:(0,i.__)("All Appointments","appointment-booking")})}),(0,s.jsx)(a.CardBody,{children:0===e.length?(0,s.jsx)("p",{children:(0,i.__)("No appointments found.","appointment-booking")}):(0,s.jsxs)("div",{className:"appointments-table",children:[(0,s.jsxs)("div",{className:"appointments-header",children:[(0,s.jsx)("div",{children:(0,i.__)("Client","appointment-booking")}),(0,s.jsx)("div",{children:(0,i.__)("Phone","appointment-booking")}),(0,s.jsx)("div",{children:(0,i.__)("Date","appointment-booking")}),(0,s.jsx)("div",{children:(0,i.__)("Time","appointment-booking")}),(0,s.jsx)("div",{children:(0,i.__)("Status","appointment-booking")}),(0,s.jsx)("div",{children:(0,i.__)("Actions","appointment-booking")})]}),e.map(e=>(0,s.jsx)(l,{appointment:e,onStatusUpdate:m,onDelete:h},e.id))]})})]})]})};t()(()=>{(0,o.createRoot)(document.getElementById("appointment-booking-admin")).render((0,s.jsx)(p,{}))})})();